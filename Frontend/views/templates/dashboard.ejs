<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SOILY - Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/logo2.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #25995c;
        --primary-dark: #007236;
        --secondary: #34d399;
        --bg-light: #f0fdf4;
        --text-dark: #1f2937;
        --text-light: #6b7280;
        --border: #e5e7eb;
        --white: #ffffff;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: "Poppins", sans-serif;
        background: var(--bg-light);
        color: var(--text-dark);
        line-height: 1.6;
      }

      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        width: 260px;
        background: var(--white);
        border-right: 1px solid var(--border);
        padding: 24px 0;
        overflow-y: auto;
        transition: transform 0.3s ease;
        z-index: 1000;
      }

      .sidebar.hidden {
        transform: translateX(-100%);
      }

      .sidebar-header {
        padding: 0 24px 24px;
        border-bottom: 1px solid var(--border);
      }

      .logo-container {
        display: flex;
        align-items: center;
      }

      .logo-container img {
        width: auto;
        height: 60px;
        margin: 0 auto;
      }

      .nav-menu {
        padding: 24px 0;
      }

      .nav-item {
        padding: 12px 24px;
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--text-light);
        text-decoration: none;
        transition: all 0.2s;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      .nav-item:hover,
      .nav-item.active {
        background: var(--bg-light);
        color: var(--primary);
        border-left: 3px solid var(--primary);
      }

      .nav-icon {
        width: 20px;
        height: 20px;
      }

      .main-content {
        margin-left: 260px;
        min-height: 100vh;
        transition: margin-left 0.3s ease;
      }

      .main-content.expanded {
        margin-left: 0;
      }

      .top-bar {
        background: var(--white);
        padding: 16px 32px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .menu-toggle {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
      }

      .search-box {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--bg-light);
        padding: 8px 16px;
        border-radius: 8px;
        flex: 1;
        max-width: 400px;
      }

      .search-box input {
        border: none;
        background: none;
        outline: none;
        width: 100%;
        font-family: "Poppins", sans-serif;
      }

      .top-bar-actions {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .language-selector {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--white);
        cursor: pointer;
        font-family: "Poppins", sans-serif;
        font-size: 14px;
      }

      .notification-btn {
        position: relative;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
      }

      .notification-badge {
        position: absolute;
        top: 4px;
        right: 4px;
        width: 8px;
        height: 8px;
        background: #ef4444;
        border-radius: 50%;
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .user-profile:hover {
        background: var(--bg-light);
      }

      .user-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
      }

      .user-info h4 {
        font-size: 14px;
        font-weight: 600;
      }

      .user-info p {
        font-size: 12px;
        color: var(--text-light);
      }

      .dashboard-content {
        padding: 32px;
      }

      .page-header {
        margin-bottom: 32px;
      }

      .page-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 8px;
      }

      .page-subtitle {
        color: var(--text-light);
        font-size: 14px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
      }

      .stat-card {
        background: var(--white);
        padding: 24px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        transition: transform 0.2s;
      }

      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
      }

      .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
      }

      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .stat-icon.primary {
        background: rgba(37, 153, 92, 0.1);
        color: var(--primary);
      }

      .stat-icon.secondary {
        background: rgba(52, 211, 153, 0.1);
        color: var(--secondary);
      }

      .stat-icon.warning {
        background: rgba(251, 191, 36, 0.1);
        color: #f59e0b;
      }

      .stat-icon.info {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 4px;
      }

      .stat-label {
        color: var(--text-light);
        font-size: 14px;
        font-weight: 500;
      }

      .weather-card {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: var(--shadow-lg);
        margin-bottom: 32px;
      }

      .weather-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .weather-location {
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .weather-time {
        font-size: 12px;
        opacity: 0.9;
      }

      .weather-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .weather-temp {
        font-size: 56px;
        font-weight: 700;
      }

      .weather-desc {
        font-size: 16px;
        opacity: 0.9;
        margin-top: 8px;
      }

      .weather-icon {
        font-size: 72px;
      }

      .weather-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .weather-detail {
        text-align: center;
      }

      .weather-detail-label {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 4px;
      }

      .weather-detail-value {
        font-size: 18px;
        font-weight: 600;
      }

      .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
      }

      .card {
        background: var(--white);
        padding: 24px;
        border-radius: 12px;
        box-shadow: var(--shadow);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .card-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
      }

      .card-action {
        color: var(--primary);
        font-size: 14px;
        text-decoration: none;
        font-weight: 500;
      }

      .quick-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }

      .action-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: var(--bg-light);
        border: 2px solid transparent;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        color: var(--text-dark);
      }

      .action-btn:hover {
        border-color: var(--primary);
        background: white;
      }

      .action-icon {
        width: 40px;
        height: 40px;
        background: var(--primary);
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .action-text h4 {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .action-text p {
        font-size: 12px;
        color: var(--text-light);
      }

      .activity-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .activity-item {
        display: flex;
        gap: 12px;
        padding: 12px;
        background: var(--bg-light);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .activity-item:hover {
        background: #e8f5e9;
        transform: translateX(4px);
      }

      .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .activity-content h4 {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .activity-content p {
        font-size: 12px;
        color: var(--text-light);
      }

      .activity-time {
        font-size: 11px;
        color: var(--text-light);
        margin-top: 4px;
      }

      .recommendations {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .recommendation-item {
        padding: 16px;
        background: linear-gradient(135deg, rgba(37, 153, 92, 0.1), rgba(52, 211, 153, 0.1));
        border-left: 4px solid var(--primary);
        border-radius: 8px;
      }

      .recommendation-item h4 {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--primary);
      }

      .recommendation-item p {
        font-size: 13px;
        color: var(--text-dark);
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: var(--text-light);
      }

      .spinner {
        border: 3px solid var(--border);
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 12px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      @media (max-width: 1024px) {
        .content-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .menu-toggle {
          display: block;
        }

        .dashboard-content {
          padding: 20px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .weather-details {
          grid-template-columns: repeat(2, 1fr);
        }

        .quick-actions {
          grid-template-columns: 1fr;
        }

        .search-box {
          display: none;
        }

        .user-info {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo-container">
          <img src="/logo1.png" alt="SOILY Logo" />
        </div>
      </div>

      <nav class="nav-menu">
        <a href="/dashboard" class="nav-item active">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          <span data-translate="nav_dashboard">Dashboard</span>
        </a>

        <a href="/soil-map" class="nav-item">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
          </svg>
          <span data-translate="nav_soil_map">Soil Map</span>
        </a>

        <a href="/reports" class="nav-item">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span data-translate="nav_reports">Reports</span>
        </a>

        <a href="/profile" class="nav-item">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <span data-translate="nav_profile">Profile</span>
        </a>

        <a href="/auth/logout" class="nav-item" style="margin-top: 20px; color: #ef4444">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          <span data-translate="nav_logout">Logout</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
      <!-- Top Bar -->
      <div class="top-bar">
        <button class="menu-toggle" id="menuToggle">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>

        <div class="search-box">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <input type="text" placeholder="Search..." data-translate-placeholder="search_placeholder" />
        </div>

        <div class="top-bar-actions">
          <select class="language-selector" id="languageSelector">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
            <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
          </select>

          <button class="notification-btn">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <span class="notification-badge"></span>
          </button>

          <div class="user-profile" onclick="window.location.href='/profile'">
            <div class="user-avatar" id="userAvatar">F</div>
            <div class="user-info">
              <h4 id="userName">Farmer</h4>
              <p id="userLocation">Loading...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard Content -->
      <div class="dashboard-content">
        <!-- Page Header -->
        <div class="page-header">
          <h1 class="page-title" data-translate="welcome">Welcome back</h1>
          <p class="page-subtitle" data-translate="dashboard_subtitle">Here's what's happening with your farm today</p>
        </div>

        <!-- Weather Card -->
        <div class="weather-card" id="weatherCard">
          <div class="loading">
            <div class="spinner"></div>
            <p data-translate="loading_weather">Loading weather data...</p>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-value" id="farmArea">0</div>
                <div class="stat-label" data-translate="stat_farm_area">Farm Area (Acres)</div>
              </div>
              <div class="stat-icon primary"><i class="fa-solid fa-wheat-awn" style="color: #000000;"></i></div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-value" id="soilHealth">--</div>
                <div class="stat-label" data-translate="stat_soil_health">Soil Health Score</div>
              </div>
              <div class="stat-icon secondary"><i class="fa-solid fa-seedling" style="color: #000000;"></i></div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-value" id="activeMaps">0</div>
                <div class="stat-label" data-translate="stat_active_maps">Active Maps</div>
              </div>
              <div class="stat-icon warning"><i class="fa-solid fa-map-location-dot" style="color: #000000;"></i></div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-value" id="recommendations">0</div>
                <div class="stat-label" data-translate="stat_recommendations">New Recommendations</div>
              </div>
              <div class="stat-icon info"><i class="fa-solid fa-lightbulb" style="color: #000000;"></i></div>
            </div>
          </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
          <!-- Quick Actions -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-translate="quick_actions">Quick Actions</h3>
            </div>
            <div class="quick-actions">
              <a href="/soil-map" class="action-btn">
                <div class="action-icon"><i class="fa-solid fa-map-location-dot" style="color: #ffffff;"></i></div>
                <div class="action-text">
                  <h4 data-translate="action_new_map">Create Soil Map</h4>
                  <p data-translate="action_new_map_desc">Draw or upload farm area</p>
                </div>
              </a>
              <a href="/reports" class="action-btn">
                <div class="action-icon"><i class="fa-solid fa-file" style="color: #ffffff;"></i></div>
                <div class="action-text">
                  <h4 data-translate="action_view_reports">View Reports</h4>
                  <p data-translate="action_view_reports_desc">See soil analysis history</p>
                </div>
              </a>
              <a href="/soil-map" class="action-btn">
                <div class="action-icon"><i class="fa-solid fa-lightbulb" style="color: #ffffff;"></i></div>
                <div class="action-text">
                  <h4 data-translate="action_view_recommendations">Get Recommendations</h4>
                  <p data-translate="action_view_recommendations_desc">Crop & fertilizer suggestions</p>
                </div>
              </a>
              <a href="/reports" class="action-btn">
                <div class="action-icon"><i class="fa-solid fa-download" style="color: #ffffff;"></i></div>
                <div class="action-text">
                  <h4 data-translate="action_generate_report">Download Reports</h4>
                  <p data-translate="action_generate_report_desc">Export PDF analysis</p>
                </div>
              </a>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-translate="recent_activity">Recent Activity</h3>
              <a href="/reports" class="card-action" data-translate="view_all">View All</a>
            </div>
            <div class="activity-list" id="activityList">
              <div class="loading">
                <div class="spinner"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recommendations Card -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-translate="personalized_recommendations">Personalized Recommendations</h3>
            <a href="/soil-map" class="card-action" data-translate="view_all">View All</a>
          </div>
          <div class="recommendations" id="recommendationsList">
            <div class="loading">
              <div class="spinner"></div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      const translations = {
        en: {
          nav_dashboard: "Dashboard",
          nav_soil_map: "Soil Map",
          nav_reports: "Reports",
          nav_profile: "Profile",
          nav_logout: "Logout",
          search_placeholder: "Search...",
          welcome: "Welcome back",
          dashboard_subtitle: "Here's what's happening with your farm today",
          loading_weather: "Loading weather data...",
          stat_farm_area: "Farm Area (Acres)",
          stat_soil_health: "Soil Health Score",
          stat_active_maps: "Active Maps",
          stat_recommendations: "New Recommendations",
          quick_actions: "Quick Actions",
          action_new_map: "Create Soil Map",
          action_new_map_desc: "Draw or upload farm area",
          action_view_reports: "View Reports",
          action_view_reports_desc: "See soil analysis history",
          action_view_recommendations: "Get Recommendations",
          action_view_recommendations_desc: "Crop & fertilizer suggestions",
          action_generate_report: "Download Reports",
          action_generate_report_desc: "Export PDF analysis",
          recent_activity: "Recent Activity",
          view_all: "View All",
          personalized_recommendations: "Personalized Recommendations",
        },
        hi: {
          nav_dashboard: "‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
          nav_soil_map: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§®‡§ï‡•ç‡§∂‡§æ",
          nav_reports: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
          nav_profile: "‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤",
          nav_logout: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü",
          search_placeholder: "‡§ñ‡•ã‡§ú‡•á‡§Ç...",
          welcome: "‡§µ‡§æ‡§™‡§∏‡•Ä ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à",
          dashboard_subtitle: "‡§Ü‡§ú ‡§Ü‡§™‡§ï‡•á ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à",
          loading_weather: "‡§Æ‡•å‡§∏‡§Æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
          stat_farm_area: "‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (‡§è‡§ï‡§°‡§º)",
          stat_soil_health: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•ç‡§ï‡•ã‡§∞",
          stat_active_maps: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§®‡§ï‡•ç‡§∂‡•á",
          stat_recommendations: "‡§®‡§à ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç",
          quick_actions: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø",
          action_new_map: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§®‡§ï‡•ç‡§∂‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç",
          action_new_map_desc: "‡§ñ‡•á‡§§ ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç",
          action_view_reports: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç",
          action_view_reports_desc: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç",
          action_view_recommendations: "‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç",
          action_view_recommendations_desc: "‡§´‡§∏‡§≤ ‡§î‡§∞ ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§∏‡•Å‡§ù‡§æ‡§µ",
          action_generate_report: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
          action_generate_report_desc: "PDF ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
          recent_activity: "‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø",
          view_all: "‡§∏‡§≠‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç",
          personalized_recommendations: "‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂‡•á‡§Ç",
        },
        mr: {
          nav_dashboard: "‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
          nav_soil_map: "‡§Æ‡§æ‡§§‡•Ä ‡§®‡§ï‡§æ‡§∂‡§æ",
          nav_reports: "‡§Ö‡§π‡§µ‡§æ‡§≤",
          nav_profile: "‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤",
          nav_logout: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü",
          search_placeholder: "‡§∂‡•ã‡§ß‡§æ...",
          welcome: "‡§™‡§∞‡§§ ‡§Ø‡•á‡§£‡•ç‡§Ø‡§æ‡§∏ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á",
          dashboard_subtitle: "‡§Ü‡§ú ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡•á‡§§‡§æ‡§§ ‡§ï‡§æ‡§Ø ‡§ò‡§°‡§§ ‡§Ü‡§π‡•á",
          loading_weather: "‡§π‡§µ‡§æ‡§Æ‡§æ‡§® ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...",
          stat_farm_area: "‡§∂‡•á‡§§ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (‡§è‡§ï‡§∞)",
          stat_soil_health: "‡§Æ‡§æ‡§§‡•Ä ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§∏‡•ç‡§ï‡•ã‡§Ö‡§∞",
          stat_active_maps: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§®‡§ï‡§æ‡§∂‡•á",
          stat_recommendations: "‡§®‡§µ‡•Ä‡§® ‡§∂‡§ø‡§´‡§æ‡§∞‡§∏‡•Ä",
          quick_actions: "‡§ú‡§≤‡§¶ ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ",
          action_new_map: "‡§Æ‡§æ‡§§‡•Ä ‡§®‡§ï‡§æ‡§∂‡§æ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ",
          action_new_map_desc: "‡§∂‡•á‡§§ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ",
          action_view_reports: "‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§™‡§π‡§æ",
          action_view_reports_desc: "‡§Æ‡§æ‡§§‡•Ä ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§™‡§π‡§æ",
          action_view_recommendations: "‡§∂‡§ø‡§´‡§æ‡§∞‡§∏‡•Ä ‡§™‡§π‡§æ",
          action_view_recommendations_desc: "‡§™‡•Ä‡§ï ‡§Ü‡§£‡§ø ‡§ñ‡§§ ‡§∏‡•Ç‡§ö‡§®‡§æ",
          action_generate_report: "‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ",
          action_generate_report_desc: "PDF ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡§æ",
          recent_activity: "‡§Ö‡§≤‡•Ä‡§ï‡§°‡•Ä‡§≤ ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ï‡§≤‡§æ‡§™",
          view_all: "‡§∏‡§∞‡•ç‡§µ ‡§™‡§π‡§æ",
          personalized_recommendations: "‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§∂‡§ø‡§´‡§æ‡§∞‡§∏‡•Ä",
        }
      };

      class SoilyDashboard {
        constructor() {
          this.currentLanguage = "en";
          this.farmerData = null;
          this.init();
        }

        async init() {
          this.setupEventListeners();
          await this.loadFarmerData();
          await this.loadDashboardStats();
          await this.loadWeather();
          await this.loadRecentActivity();
          await this.loadRecommendations();
        }

        setupEventListeners() {
          const menuToggle = document.getElementById("menuToggle");
          const sidebar = document.getElementById("sidebar");

          menuToggle?.addEventListener("click", () => {
            sidebar.classList.toggle("active");
          });

          const languageSelector = document.getElementById("languageSelector");
          languageSelector?.addEventListener("change", (e) => {
            this.changeLanguage(e.target.value);
          });

          document.addEventListener("click", (e) => {
            if (window.innerWidth <= 768) {
              if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                sidebar.classList.remove("active");
              }
            }
          });
        }

        async loadFarmerData() {
          try {
            const response = await fetch("/api/farmer/profile");
            const data = await response.json();

            if (data.success && data.farmer) {
              this.farmerData = data.farmer;
              this.updateUserUI();
            }
          } catch (error) {
            console.error("Failed to load farmer data:", error);
          }
        }

        updateUserUI() {
          const farmer = this.farmerData;

          document.getElementById("userName").textContent = farmer.fullName;
          document.getElementById("userLocation").textContent = farmer.location;
          document.getElementById("userAvatar").textContent = farmer.fullName.charAt(0).toUpperCase();

          if (farmer.preferredLanguage) {
            this.currentLanguage = farmer.preferredLanguage;
            document.getElementById("languageSelector").value = farmer.preferredLanguage;
            this.translatePage(farmer.preferredLanguage);
          }
        }

        async loadDashboardStats() {
          try {
            const response = await fetch('/api/dashboard/stats');
            const data = await response.json();

            if (data.success && data.stats) {
              this.updateStatsUI(data.stats);
            }
          } catch (error) {
            console.error('Failed to load dashboard stats:', error);
            this.displayMockStats();
          }
        }

        updateStatsUI(stats) {
          document.getElementById("farmArea").textContent = stats.farmArea || '0';
          document.getElementById("soilHealth").textContent = stats.soilHealth || '--';
          document.getElementById("activeMaps").textContent = stats.activeMaps || '0';
          document.getElementById("recommendations").textContent = stats.recommendations || '0';

          const soilHealthEl = document.getElementById("soilHealth");
          if (typeof stats.soilHealth === 'number') {
            if (stats.soilHealth >= 75) {
              soilHealthEl.style.color = '#10b981';
            } else if (stats.soilHealth >= 50) {
              soilHealthEl.style.color = '#f59e0b';
            } else {
              soilHealthEl.style.color = '#ef4444';
            }
          }
        }

        displayMockStats() {
          document.getElementById("farmArea").textContent = '0';
          document.getElementById("soilHealth").textContent = '--';
          document.getElementById("activeMaps").textContent = '0';
          document.getElementById("recommendations").textContent = '0';
        }

        async loadWeather() {
          const weatherCard = document.getElementById("weatherCard");

          if (!this.farmerData?.location) {
            weatherCard.innerHTML = '<div class="loading"><p>Location not available</p></div>';
            return;
          }

          try {
            const apiKey = "0a315c49aff3f7e234472a7e343be4a2";
            const location = this.farmerData.location;
            const response = await fetch(
              `https://api.openweathermap.org/data/2.5/weather?q=${location},IN&units=metric&appid=${apiKey}`
            );

            if (!response.ok) throw new Error("Weather fetch failed");

            const weather = await response.json();
            this.displayWeather(weather);
          } catch (error) {
            console.error("Weather fetch error:", error);
            this.displayMockWeather();
          }
        }

        displayWeather(weather) {
          const weatherCard = document.getElementById("weatherCard");
          const weatherEmoji = this.getWeatherEmoji(weather.weather[0].main);

          weatherCard.innerHTML = `
            <div class="weather-header">
              <div class="weather-location">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                ${weather.name}
              </div>
              <div class="weather-time">${new Date().toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" })}</div>
            </div>
            <div class="weather-main">
              <div>
                <div class="weather-temp">${Math.round(weather.main.temp)}¬∞C</div>
                <div class="weather-desc">${weather.weather[0].description}</div>
              </div>
              <div class="weather-icon">${weatherEmoji}</div>
            </div>
            <div class="weather-details">
              <div class="weather-detail">
                <div class="weather-detail-label">Humidity</div>
                <div class="weather-detail-value">${weather.main.humidity}%</div>
              </div>
              <div class="weather-detail">
                <div class="weather-detail-label">Wind Speed</div>
                <div class="weather-detail-value">${weather.wind.speed} m/s</div>
              </div>
              <div class="weather-detail">
                <div class="weather-detail-label">Feels Like</div>
                <div class="weather-detail-value">${Math.round(weather.main.feels_like)}¬∞C</div>
              </div>
            </div>
          `;
        }

        displayMockWeather() {
          const weatherCard = document.getElementById("weatherCard");
          const location = this.farmerData?.location || "Your Farm";

          weatherCard.innerHTML = `
            <div class="weather-header">
              <div class="weather-location">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                ${location}
              </div>
              <div class="weather-time">${new Date().toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" })}</div>
            </div>
            <div class="weather-main">
              <div>
                <div class="weather-temp">28¬∞C</div>
                <div class="weather-desc">Partly cloudy</div>
              </div>
              <div class="weather-icon">‚õÖ</div>
            </div>
            <div class="weather-details">
              <div class="weather-detail">
                <div class="weather-detail-label">Humidity</div>
                <div class="weather-detail-value">65%</div>
              </div>
              <div class="weather-detail">
                <div class="weather-detail-label">Wind Speed</div>
                <div class="weather-detail-value">12 km/h</div>
              </div>
              <div class="weather-detail">
                <div class="weather-detail-label">Feels Like</div>
                <div class="weather-detail-value">30¬∞C</div>
              </div>
            </div>
          `;
        }

        getWeatherEmoji(condition) {
          const emojis = {
            Clear: "‚òÄÔ∏è",
            Clouds: "‚òÅÔ∏è",
            Rain: "üåßÔ∏è",
            Drizzle: "üå¶Ô∏è",
            Thunderstorm: "‚õàÔ∏è",
            Snow: "‚ùÑÔ∏è",
            Mist: "üå´Ô∏è",
            Fog: "üå´Ô∏è",
          };
          return emojis[condition] || "üå§Ô∏è";
        }

        async loadRecentActivity() {
          const activityList = document.getElementById("activityList");
          
          try {
            const response = await fetch('/api/dashboard/recent-activity');
            const data = await response.json();

            if (data.success && data.activities && data.activities.length > 0) {
              activityList.innerHTML = data.activities.map(activity => `
                <div class="activity-item" onclick="window.location.href='${activity.link || '#'}'">
                  <div class="activity-icon">${activity.icon}</div>
                  <div class="activity-content">
                    <h4>${activity.title}</h4>
                    <p>${activity.desc}</p>
                    <div class="activity-time">${activity.time}</div>
                  </div>
                </div>
              `).join('');
            } else {
              activityList.innerHTML = `
                <div class="activity-item" onclick="window.location.href='/soil-map'">
                  <div class="activity-icon">üå±</div>
                  <div class="activity-content">
                    <h4>Welcome to SOILY!</h4>
                    <p>Start by creating your first soil analysis</p>
                    <div class="activity-time">Just now</div>
                  </div>
                </div>
              `;
            }
          } catch (error) {
            console.error('Failed to load recent activity:', error);
            this.displayMockActivity();
          }
        }

        displayMockActivity() {
          const activityList = document.getElementById("activityList");
          activityList.innerHTML = `
            <div class="activity-item" onclick="window.location.href='/soil-map'">
              <div class="activity-icon">üå±</div>
              <div class="activity-content">
                <h4>Welcome to SOILY!</h4>
                <p>Start by creating your first soil analysis</p>
                <div class="activity-time">Just now</div>
              </div>
            </div>
          `;
        }

        async loadRecommendations() {
          const recommendationsList = document.getElementById("recommendationsList");
          
          try {
            const response = await fetch('/api/dashboard/recommendations');
            const data = await response.json();

            if (data.success && data.recommendations && data.recommendations.length > 0) {
              recommendationsList.innerHTML = data.recommendations.map(rec => `
                <div class="recommendation-item">
                  <h4>${rec.title}</h4>
                  <p>${rec.desc}</p>
                </div>
              `).join('');
            } else {
              this.displayMockRecommendations();
            }
          } catch (error) {
            console.error('Failed to load recommendations:', error);
            this.displayMockRecommendations();
          }
        }

        displayMockRecommendations() {
          const recommendationsList = document.getElementById("recommendationsList");
          recommendationsList.innerHTML = `
            <div class="recommendation-item">
              <h4>üó∫Ô∏è Create Your First Soil Map</h4>
              <p>Start by mapping your farm boundaries and analyzing your soil to get personalized recommendations.</p>
            </div>
            <div class="recommendation-item">
              <h4>üìä Upload Lab Results</h4>
              <p>If you have soil test results from a laboratory, upload them for more accurate crop recommendations.</p>
            </div>
            <div class="recommendation-item">
              <h4>üåæ Explore Crop Database</h4>
              <p>Browse through our extensive crop database to learn about different crops suitable for your region.</p>
            </div>
          `;
        }

        async changeLanguage(lang) {
          this.currentLanguage = lang;
          this.translatePage(lang);

          try {
            await fetch("/api/language", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ language: lang }),
            });
          } catch (error) {
            console.error("Failed to update language:", error);
          }
        }

        translatePage(lang) {
          const trans = translations[lang] || translations.en;

          document.querySelectorAll("[data-translate]").forEach((element) => {
            const key = element.getAttribute("data-translate");
            if (trans[key]) {
              element.textContent = trans[key];
            }
          });

          document.querySelectorAll("[data-translate-placeholder]").forEach((element) => {
            const key = element.getAttribute("data-translate-placeholder");
            if (trans[key]) {
              element.placeholder = trans[key];
            }
          });
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        new SoilyDashboard();
      });
    </script>
  </body>
</html>
